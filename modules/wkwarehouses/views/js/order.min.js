/**
* NOTICE OF LICENSE
*
* This file is part of the 'Wk Warehouses Management For Prestashop 1.7' module feature.
* Developped by Khoufi Wissem (2018).
* You are not allowed to use it on several site
* You are not allowed to sell or redistribute this module
* This header must not be removed
*
*  @author    KHOUFI Wissem - K.W
*  @copyright Khoufi Wissem
*  @license   http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
*/
function fixDeliveryOptionsMarginTop(t){$(".delivery-options .delivery-option .col-sm-1").each(function(e){t=$(this).closest(".delivery-option").height()/2-11,$(this).css("margin-top",t+"px")}),$(".delivery-option label .totalShippingPrice").css({"margin-top":t+"px","text-align":"right"})}function displayCarrierLine(t,e){return shipping_line='\t\t\t<div class="col-sm-'+(void 0!==e&&e?"8":"5")+' col-xs-12">',shipping_line+='\t\t\t\t<div class="row">',null!=t.logo&&0!=t.logo&&t.logo&&(shipping_line+='\t\t\t\t<div class="col-xs-3" '+("undefined"!=typeof OnePageCheckoutPS?'style="padding: 0;"':"")+">",shipping_line+='\t\t\t\t\t<img src="'+t.logo+'" alt="'+(t.name?t.name:"")+'"/>',shipping_line+="\t\t\t\t</div>"),shipping_line+='\t\t\t\t\t<div class="'+(t.logo?"col-xs-9":"col-xs-12")+'">',shipping_line+='\t\t\t\t\t\t<span class="h6 carrier-name">'+t.name+(t.warehouse_name?"<br><small>"+t.warehouse_name+"</small>":"")+"</span>",shipping_line+="\t\t\t\t\t</div>",shipping_line+="\t\t\t\t</div>",shipping_line+="\t\t\t</div>",shipping_line+='\t\t\t<div class="col-sm-4 col-xs-12">',shipping_line+='\t\t\t\t<span class="carrier-delay">'+t.delay+"</span>",shipping_line+="\t\t\t</div>",shipping_line}function passToCarriersStep(){var t=!0;return $("#checkout-addresses-step .js-address-form .delivery-addresses-table").length&&$("#checkout-addresses-step .delivery-addresses-table .cart_address_delivery").each(function(e){""!=$(this).val()&&null!=$(this).val()||(t=!1)}),t}function fancyCloseBox(t,e){var i='<p style="text-align:right; padding-bottom: 0" class="submit">';i+='<input type="button" onclick="$.fancybox.close();" value="'+txt_ok+'" class="button btn btn-danger">',i+="</p>",$.fancybox('<div class="alert alert-'+e+'">'+t+"</div>"+i)}function arrayUnique(t){var e=[];return $.each(t,function(t,i){-1==$.inArray(i,e)&&e.push(i)}),e}$(document).ready(function(){function printCarrierLines(t){var e,i,s;if(console.log(t.length),t.length>0){if("undefined"!=typeof delivery_option_list){for(k in t.empty(),e="",delivery_option_list)for(key in i=!1,id_address=k,package=delivery_option_list[k],e+='<div class="row multi-shipping-row" style="background-color:#555; color:#FFF; padding:3px">',void 0!==address_collection[id_address]&&address_collection[id_address]?e+=txt_choose_shipping_adress+" "+address_collection[id_address].alias:e+=txt_choose_shipping,e+="</div>",e+='<div class="clearfix"></div>',package){if(carrier_id=key,carrier=package[key],e+='<div class="row delivery-option">',e+='\t<div class="col-sm-1">',e+='\t\t<span class="custom-radio float-xs-left">',e+='\t\t\t<input type="radio" '+("undefined"!=typeof OnePageCheckoutPS?'class="delivery_option_radio"':"")+' name="delivery_option['+id_address+']" id="delivery_option_'+carrier_id+'" value="'+carrier_id+'"'+(carrier.selected?" checked":"")+">",e+="\t\t\t<span></span>",e+="\t\t</span>",e+="\t</div>",e+='\t<label for="delivery_option_'+carrier_id+'" class="col-sm-11 delivery-option-2">',e+='\t\t<div class="row'+(void 0!==carrier.carriers_table?" col-xs-8":"")+'">',s="",void 0!==carrier.carriers_table)for(index in i=!0,carrier.carriers_table)""!=carrier.carriers_table[index].extraContent&&(s+='<div class="col-sm-12" style="border: 1px solid antiquewhite; padding: 5px; margin-bottom:20px">'+carrier.carriers_table[index].extraContent+"</div>"),e+=displayCarrierLine(carrier.carriers_table[index],i),index!=carrier.carriers_table.length-1&&(e+='<hr class="col-sm-11"/>');else e+=displayCarrierLine(carrier);i&&(e+="\t</div>"),e+='\t\t\t<div class="col-sm-3 col-xs-12 totalShippingPrice">',e+='\t\t\t\t<span class="carrier-price">'+carrier.price+"</span>",e+="\t\t\t</div>",e+="\t\t</div>",e+="\t</label>",e+="</div>",e+='<div class="row carrier-extra-content" style="'+(carrier_id!=delivery_option?"display:none;":"")+(""!=s?"margin-left: 20px; margin-right: 0px;":"")+'">',e+=""!=s&&i?s:carrier.extraContent,e+="</div>",e+='<div class="clearfix"></div>'}t.html(e),i&&fixDeliveryOptionsMarginTop()}$(document).on("click","#checkout-delivery-step .step-title",function(t){$("#checkout-delivery-step").find(".content").is(":visible")&&fixDeliveryOptionsMarginTop()})}}if($("#delivery-addresses").length>0&&$("div.js-address-form form").length>0&&"undefined"!=typeof cart_collection&&cart_collection.length>0){$addressesContainer=$("#delivery-addresses"),$addressesContainer.parent().find("h2").first().html(txt_delivery_addresses),$.each($addressesContainer,function(t,e){$address_item=$(e).find(".address-item"),$address_item.length>0&&($address_item.removeClass("selected"),$address_item.find("input[type=radio][name='id_address_delivery']").parent().replaceWith(""))}),material_icon_style='style="font-size:1.2em"',cart_html='<h2 class="h4">'+txt_choose_addresses+"</h2>",cart_html+='<div class="delivery-addresses-table">',cart_html+='  <ul class="cart-items" style="margin-bottom: 15px; background-color:#f6f6f6">';for(var t=0;t<cart_collection.length;t++){for(k in cartLine=cart_collection[t],cart_html+='<li class="cart-item" style="border-bottom:1px solid #ddd; box-shadow: 0px 1px #FFFFFF;">',cart_html+='<div class="product-line-grid">',cart_html+='<div class="product-line-grid-left col-md-3 col-xs-4">',cart_html+='\t<span class="product-image media-middle">',cart_html+='\t\t<img src="'+cartLine.image+'" alt="'+cartLine.name+'">',cart_html+="\t</span>",cart_html+="</div>",cart_html+='<div class="product-line-grid-body col-md-5 col-xs-8">',cart_html+='\t<div class="product-line-info">',cart_html+='\t\t<a class="label" href="'+cartLine.url+'">'+cartLine.name+"</a>",cart_html+="\t</div>",cart_html+='\t<div class="product-line-info product-price h5'+(cartLine.has_discount?" has-discount":"")+'">',cartLine.has_discount&&(cart_html+='\t<div class="product-discount">',cart_html+='\t\t<span class="regular-price">'+cartLine.regular_price+"</span>","percentage"===cartLine.discount_type?(cart_html+='\t<span class="discount discount-percentage">',cart_html+="\t\t-"+cartLine.discount_percentage_absolute,cart_html+="\t</span>"):(cart_html+='\t<span class="discount discount-amount">',cart_html+="\t\t-"+cartLine.discount_to_display,cart_html+="\t</span>"),cart_html+="\t</div>"),cart_html+='\t\t<div class="current-price">',cart_html+='\t\t\t<span class="price">'+cartLine.price+"</span>",cartLine.unit_price_full&&(cart_html+='\t\t<div class="unit-price-cart">'+cartLine.unit_price_full+"</div>"),cart_html+="\t\t</div>",cart_html+="\t</div>",cartLine.attributes.length>0&&(cart_html+="<br/>",cart_html+="<small>"+cartLine.attributes.join("; ")+"</small>"),void 0!==cartLine.warehouse_name&&""!=cartLine.warehouse_name&&(cart_html+="<br/>",cart_html+="<small><strong>"+txt_warehouse+":</strong> "+cartLine.warehouse_name,void 0!==cartLine.warehouse_country_name&&""!=cartLine.warehouse_country_name&&0!=cartLine.address_list.length&&(cart_html+=" ("+cartLine.warehouse_country_name+")"),cart_html+="</small>"),cart_html+="\t</div>",cart_html+='\t<div class="product-line-grid-right product-line-actions col-md-4 col-xs-12">',cart_html+='\t\t<div class="row">',cart_html+='\t\t\t<div class="col-xs-4 hidden-md-up"></div>',cart_html+='\t\t\t<div class="col-md-12 text-xs-right">',cart_html+='\t\t\t\t<select id="select_address_delivery_'+cartLine.id_product+"_"+cartLine.id_product_attribute+"_"+cartLine.id_address_delivery+"_"+cartLine.id_warehouse+'" ',cart_html+='\t\t\t\tclass="form-control form-control-select cart_address_delivery">',0==cartLine.id_address_delivery&&"undefined"!=typeof delivery_cart_id&&0==delivery_cart_id&&(cart_html+="\t\t\t\t<option></option>"),cartLine.address_list)id_address=parseInt(cartLine.address_list[k].id_address),cart_html+='\t\t\t\t<option value="'+id_address+'" '+(cartLine.address_list[k].selected?' selected="selected"':"")+">"+cartLine.address_list[k].alias,cart_html+="\t\t\t\t</option>";cart_html+="\t\t\t\t</select>",0==cartLine.address_list.length&&(cart_html+="<br />"+($(".add-address").length>0?"<small>"+$(".add-address").html().replace('class="material-icons"','class="material-icons" '+material_icon_style)+"</small>":""),cartLine.best_zone,cartLine.best_zone&&(delivery_countries="<strong>"+txt_delivery_where+"</strong><br />"+cartLine.best_zone,cart_html+='<br /><small><a href="javascript:void(0)" onclick="fancyCloseBox(delivery_countries, \'success\');">',cart_html+='<i class="material-icons" '+material_icon_style+">&#xE145;</i> "+txt_countries_zone,cart_html+="</a></small>"),void 0!==cartLine.warehouse_country_name&&""!=cartLine.warehouse_country_name&&(cart_html+="<br /><small><strong>"+txt_country_zone+"</strong>: "+cartLine.warehouse_country_name+"</small>")),cart_html+="\t\t\t</div>",cart_html+="\t\t</div>",cart_html+="\t</div>",cart_html+='\t<div class="clearfix"></div>',cart_html+="</div>",cart_html+="</li>"}cart_html+="  </ul>",cart_html+="</div>",$("div.js-address-form form").prepend(cart_html)}if($(document).on("change",".cart_address_delivery",function(t){var e,i,s,r,a,l;obj=$(this),e=obj.attr("id").split("_"),i=e[3],s=e[4],r=e[5],a=obj.val(),l=e[6],a!=r&&a>0&&$.ajax({url:cart_wkwarehouses_url,type:"POST",headers:{"cache-control":"no-cache"},async:!0,cache:!1,dataType:"json",data:{ajax:!0,action:"changeAddressDelivery",id_product:i,id_product_attribute:s,id_warehouse:l,old_id_address_delivery:r,new_id_address_delivery:a},success:function(t){void 0!==t.hasErrors&&t.hasErrors?(fancyCloseBox(t.error,"danger"),$("#select_address_delivery_"+i+"_"+s+"_"+r+"_"+l).val(r)):obj.attr("id","select_address_delivery_"+i+"_"+s+"_"+a+"_"+l)}})}),$(document).on("click","#checkout-addresses-step form .continue",function(t){if(!passToCarriersStep())return fancyCloseBox(txt_incomplete_addresses,"danger"),!1}),passToCarriersStep()||($("#checkout-addresses-step").removeClass("-complete"),$("#checkout-addresses-step .content").show(),$(".delivery-options-list form .continue").attr("disabled",!0),$("#checkout-delivery-step").addClass("checkout-step -reachable -clickable -unreachable"),$("#checkout-delivery-step .step-title").addClass("not-allowed"),$("#checkout-delivery-step .content").css("display","none"),$("#checkout-payment-step").addClass("checkout-step -reachable -clickable -unreachable"),$("#checkout-payment-step .step-title").addClass("not-allowed"),$("#checkout-payment-step .content").css("display","none")),"undefined"==typeof OnePageCheckoutPS?printCarrierLines($(".delivery-options-list .delivery-options")):$(document).on("opc-load-carrier:completed",function(){printCarrierLines(AppOPC.$opc_step_two.find(".delivery-options"))}),summary_element="#order-summary-content .summary-selected-carrier",$(summary_element).length>0&&"undefined"!=typeof methods_shipping_collection){for(k in shipping_methods_html="",padding_css=$(summary_element).css("padding-top"),"undefined"==typeof padding_css&&(padding_css="undefined"!==$(summary_element).css("padding-bottom")?$(summary_element).css("padding-bottom"):"16px"),methods_shipping_collection)carrier_collection=methods_shipping_collection[k],shipping_methods_html+='<div class="row" style="'+(k!=methods_shipping_collection.length-1?"border-bottom: 1px solid #e5e5e5; padding-bottom:"+padding_css:"padding-top:"+padding_css)+'">',shipping_methods_html+='  <div class="col-md-2">',shipping_methods_html+='\t<div class="logo-container">',carrier_collection.logo?shipping_methods_html+='\t\t<img src="'+carrier_collection.logo+'" alt="'+carrier_collection.name+'">':shipping_methods_html+="\t\t&nbsp;",shipping_methods_html+="\t</div>",shipping_methods_html+="  </div>",shipping_methods_html+='  <div class="col-md-4">',shipping_methods_html+='\t<span class="carrier-name">'+carrier_collection.name+"</span>",shipping_methods_html+="  </div>",shipping_methods_html+='  <div class="col-md-4">',shipping_methods_html+='\t<span class="carrier-delay">'+carrier_collection.delay+"</span>",shipping_methods_html+="  </div>",shipping_methods_html+='  <div class="col-md-2">',shipping_methods_html+='\t<span class="carrier-price">'+carrier_collection.price+"</span>",shipping_methods_html+="  </div>",shipping_methods_html+="</div>";shipping_methods_html&&$(summary_element).html(shipping_methods_html)}$(document).on("click",".delivery-options-list form .continue",function(t){var e,i,s;if($(".delivery-options-list .multi-shipping-row").length&&(e=!0,delivery_radios_options=$(".delivery-options input[type=radio][name^='delivery_option']"),delivery_radios_options.length&&(i=delivery_radios_options.map(function(){return this.name.match(/\d+/)}).get()).length))for(i=arrayUnique(i),s=0;s<i.length;s++)if(0==$(".delivery-options input[type=radio][name^='delivery_option["+parseInt(i[s])+"]']:checked").length){e=!1;break}if(!e)return fancyCloseBox(txt_incomplete_addresses,"danger"),!1})});