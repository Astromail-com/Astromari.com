/**
* NOTICE OF LICENSE
*
* This file is part of the 'Wk Warehouses Management For Prestashop 1.7' module feature.
* Developped by Khoufi Wissem (2018).
* You are not allowed to use it on several site
* You are not allowed to sell or redistribute this module
* This header must not be removed
*
*  @author    KHOUFI Wissem - K.W
*  @copyright Khoufi Wissem
*  @license   http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
*/
function processNow(t,e,o,i){var r,s,a;0==t&&i&&updateProgressionInit(),0!=t||i||updateProgression(0,o,e,!1,null),r=(new Date).getTime(),a="sel"==(s=$(".bulk_for").val())?"&"+$("#"+formID+' input[name="productBox[]"]').serialize():"",$.ajax({type:"POST",url:url_global+"&offset="+t+"&limit="+e+(i?"&validateBefore=1":""),cache:!1,dataType:"json",data:"ajax=1&action="+$(".bulk_action").val()+"&bulk_for="+s+a,success:function(s){var a,n,d,l,c,p,u;if(s.totalCount&&(o=s.totalCount),s.informations&&s.informations.length>0&&updateValidationInfo("<li>"+s.informations.join("</li><li>")+"</li>"),s.warnings&&s.warnings.length>0&&(i?updateValidationError("<li>"+s.warnings.join("</li><li>")+"</li>",!0):updateProgressionError("<li>"+s.warnings.join("</li><li>")+"</li>",!0)),s.errors&&s.errors.length>0)i?updateValidationError("<li>"+s.errors.join("</li><li>")+"</li>",!1):updateProgressionError("<li>"+s.errors.join("</li><li>")+"</li>",!1);else if(1==!s.isFinished){if(a=(new Date).getTime()-r,n=5e3,d=Math.min(4,n/a),l=Math.min(100,Math.max(5,Math.floor(e*d))),c=t+e,i?updateValidation(s.doneCount,o,s.doneCount+l):updateProgression(s.doneCount,o,s.doneCount+l,!1),1==importCancelRequest)return $("#importProgress").modal("hide"),importCancelRequest=!1,void(window.location.href=url_global);processNow(c,l,o,i),s.nextPostSize>=.9*s.postSizeLimit&&(p=100*s.doneCount/o,u=Math.max(7,parseInt(s.postSizeLimit/(1024*p*1024)))+1,$("#import_details_post_limit_value").html(u+" MB"),$("#import_details_post_limit").show())}else i?(updateValidation(o,o,o),$("#import_details_warning").is(":visible")?(importContinueRequest=!0,$("#import_continue_button").show()):($("#import_progress_div").show(),processNow(0,5,o,!1))):(updateProgression(o,o,o,!0),document.getElementById("alarmAudio").play())},error:function(t,e,o){"parsererror"==e&&(e="Technical error: Unexpected response returned by server. Process stopped. Check logs page!"),i?updateValidationError(e,!1):updateProgressionError(e,!1)}})}function updateProgressionInit(){$("#importProgress").modal({backdrop:"static",keyboard:!1,closable:!1}),$("#importProgress").modal("show"),$("#importProgress").on("hidden.bs.modal",function(){window.location.href=url_global}),$("#import_details_progressing").show(),$("#import_details_finished").hide(),$("#import_details_error").hide(),$("#import_details_warning, #import_details_info").hide(),$("#import_details_stop").hide(),$("#import_details_post_limit").hide(),$("#import_details_error ul").html(""),$("#import_details_warning ul, #import_details_info ul").html(""),$("#import_validation_details").html($("#import_validation_details").attr("default-value")),$("#validate_progressbar_done").width("0%"),$("#validate_progressbar_done").parent().addClass("active progress-striped"),$("#validate_progression_done").html("0"),$("#validate_progressbar_done2").width("0%"),$("#validate_progressbar_next").width("0%"),$("#validate_progressbar_next").removeClass("progress-bar-danger"),$("#validate_progressbar_next").addClass("progress-bar-info"),$("#import_progress_div").hide(),$("#import_progression_details").html($("#import_progression_details").attr("default-value")),$("#import_progressbar_done").width("0%"),$("#import_progressbar_done").parent().addClass("active progress-striped"),$("#import_progression_done").html("0"),$("#import_progressbar_next").width("0%"),$("#import_progressbar_next").removeClass("progress-bar-danger"),$("#import_progressbar_next").addClass("progress-bar-success"),$("#import_stop_button").show(),$("#import_close_button").hide(),$("#import_go_button").hide(),$("#import_continue_button").hide()}function updateValidation(t,e,o){var i,r;t>e&&(t=e),o>e&&(o=e),i=100*t/e,r=100*o/e,e>0&&($("#import_validate_div").show(),$("#import_validation_details").html(t+"/"+e),$("#validate_progressbar_done").width(i+"%"),$("#validate_progression_done").html(parseInt(i)),$("#validate_progressbar_next").width(r-i+"%")),t==e&&e==o&&$("#validate_progressbar_done").parent().removeClass("active progress-striped")}function updateProgression(t,e,o,i){var r;t>e&&(t=e),o>e&&(o=e),r=100*t/e,e>0&&($("#import_progress_div").show(),$("#import_progression_details").html(t+"/"+e),$("#import_progressbar_next").width("0%"),$("#import_progressbar_done").width(100-r+"%"),$("#import_progressbar_done2").width(r+"%"),$("#import_progressbar_done2 span").html(parseInt(r)+"%")),i&&($("#import_progressbar_done").parent().removeClass("active progress-striped"),$("#import_details_post_limit").hide(),$("#import_details_progressing").hide(),$("#import_details_finished").show(),$("#importProgress").modal({keyboard:!0,closable:!0}),$("#import_stop_button").hide(),$("#import_close_button").show())}function updateValidationError(t,e){$("#import_details_progressing").hide(),$("#import_details_finished").hide(),e?($("#import_details_warning ul").append(t),$("#import_details_warning").show()):($("#import_details_error ul").append(t),$("#import_details_error").show(),$("#validate_progressbar_next").addClass("progress-bar-danger"),$("#validate_progressbar_next").removeClass("progress-bar-info"),$("#import_stop_button").hide(),$("#import_close_button").show())}function updateValidationInfo(t){$("#import_details_progressing").hide(),$("#import_details_finished").hide(),$("#import_details_info ul").append(t),$("#import_details_info").show()}function updateProgressionError(t,e){$("#import_details_progressing").hide(),$("#import_details_finished").hide(),e?($("#import_details_warning ul").append(t),$("#import_details_warning").show()):($("#import_details_error ul").append(t),$("#import_details_error").show(),$("#import_progressbar_next").addClass("progress-bar-danger"),$("#import_progressbar_next").removeClass("progress-bar-success"),$("#import_stop_button").hide(),$("#import_close_button").show())}function move(t,e){var o=t.find(".warehouseList option:selected");return o.length>1?(showErrorMessage(warehouse_required),!1):(e?o.prev().insertAfter(o):o.next().insertBefore(o),!1)}function checkAllBox(){var t=!0,e=$("#form-product").length>0?"form-product":"product";$("#"+e+" .productOutBox").each(function(){this.checked||(t=!1)}),$("#"+e+" .productOutBox").attr("checked",!t)}function initFormEditWarehousesQties(t,e,o){$(t).addClass("loading"),$.ajax({url:url_global,type:"POST",dataType:"json",data:{ajax:!0,action:"loadFormEditWarehousesQties",id_product:e,id_product_attribute:o},success:function(e){$(t).removeClass("loading"),e.hasError||($(".stage_popup_form, .form_popup").fadeIn(500),$(".form_popup .content_form").html(e.content),$(".form_popup").setCenterPositionAbsoluteScreen())}})}function fadeHelpIcon(){$(".process-icon-help").fadeOut(1e3,function(){$(this).fadeIn(2e3,fadeHelpIcon())})}function toggleWindow(t){$("#help-header").hasClass("height-transition-hidden")||"bulk"!=t||slideUpPopup("help"),$("#bulk-header").hasClass("height-transition-hidden")||"help"!=t||slideUpPopup("bulk"),$("#"+t+"-header").hasClass("height-transition-hidden")?($("body,html").animate({scrollTop:$("body").offset().top},800),$("#"+t+"-header").slideDownTransition(),$("#"+t+"-header").css({"margin-bottom":"17px"})):slideUpPopup(t)}function slideUpPopup(t){$("#"+t+"-header").slideUpTransition(),$("#"+t+"-header").css({"margin-bottom":"auto"})}var importCancelRequest,importContinueRequest,formID,url_global=window.location.href;-1!=url_global.indexOf("#")&&(url_global=url_global.split("#")[0]),importCancelRequest=!1,importContinueRequest=!1,formID="form-product",$(document).ready(function(){var t,e,o,r,s=$("#form-product").length>0?"form-product":"product",a="qpsstats-active-tab",n=window.sessionStorage,d=0;try{d=n.getItem(a)}catch(t){}$("#tabs-config").length>0&&($("#tabs-config").tabs({active:d,activate:function(t,e){var o,i=e.newTab.parent().children().index(e.newTab);try{n.setItem(a,i),o=$("body").offset().top,$("body,html").animate({scrollTop:o},800)}catch(t){}}}),$("#tabs-config").tabs().addClass("ui-tabs-vertical ui-helper-clearfix"),$("#tabs-config li").removeClass("ui-corner-top").addClass("ui-corner-left"),t=0,$(".page-head").length>0&&(t=$(".page-head").outerHeight()+$(".page-head").position().top),"msie"==$.browser&&$.browser.version<7||(e="#float-tabs",o=$(e).offset().top-parseFloat($(e).css("margin-top").replace(/auto/,0)),$(window).scroll(function(i){o<=$(this).scrollTop()?($(e).addClass("fixed"),$(e).css("top",t+"px")):$(e).removeClass("fixed")}))),fadeHelpIcon(),$(document).on("click","#filter-by-providers",function(){$(this).is(":checked")?$("#block_supplier_tree").fadeOut("slow"):$("#block_supplier_tree").fadeIn("slow")}),$(document).on("click","div#addons-rating-container p.dismiss a",function(){return $("div#addons-rating-container").hide(500),$.ajax({type:"GET",url:window.location+"&dismissRating=1"}),!1}),$(document).on("click",".check_all_warehouses",function(t){var e=$(this).closest("div").find("table tbody .chk_locations");$(this).hasClass("selected")?(e.each(function(){$(this).removeAttr("checked")}),$(this).find("i").removeClass("icon-check-sign").addClass("icon-check-empty"),$(this).removeClass("selected")):(e.each(function(){$(this).prop("checked",!0)}),$(this).find("i").removeClass("icon-check-empty").addClass("icon-check-sign"),$(this).addClass("selected"))}),$(document).on("click",".check_all",function(t){var e=$(this).is(":checked"),o=$(this).parent().parent().parent().parent();o.find(".productOutBox").prop("checked",e)}),$(document).on("click",".stage_popup_form, .close_form_popup",function(t){t.preventDefault(),$(".stage_popup_form, .form_popup").fadeOut(500)}),$(document).on("click",".edit_warehouses",function(t){var e,o,i;t.preventDefault(),e=$(this).data("id"),o=$(this).data("id-pa")?$(this).data("id-pa"):0,i=this,$(i).addClass("loading"),$.ajax({type:"POST",url:url_global,cache:!1,dataType:"json",data:{ajax:!0,action:"initFormLocations",id_product:e,id_product_attribute:o},success:function(t){$(i).removeClass("loading"),$(".stage_popup_form, .form_popup").fadeIn(500),t.error?$(".form_popup .content_form").html(t.error):$(".form_popup .content_form").html(t.html),$(".form_popup").setCenterPositionAbsoluteScreen()}})}),$(document).on("click","#save-warehouses-locations-foreach",function(t){id_product=$("#product_id").val(),id_product_attribute=$("#product_attribute_id").val(),$.ajax({url:url_global,type:"POST",async:!1,cache:!1,dataType:"json",data:"id_product="+id_product+"&ajax=1&action=processWarehousesAndLocations&id_product_attribute="+id_product_attribute+"&"+$("input[class=chk_locations]").serialize()+"&"+$("input[class=input_locations]").serialize(),success:function(t){t.error?showErrorMessage(data.error):(showSuccessMessage(update_success_msg),$(".stage_popup_form, .form_popup").fadeOut(500))}})}),$(document).on("click",".edit_warehouses_product",function(t){var e=$(this).data("id"),o=this;$(o).addClass("loading"),$.ajax({type:"POST",url:url_global,async:!1,cache:!1,dataType:"json",data:{ajax:!0,action:"initFormWarehouses",id_product:e},success:function(t){$(o).removeClass("loading"),$(".stage_popup_form, .form_popup").fadeIn(500),t.error?$(".form_popup .content_form").html(t.error):$(".form_popup .content_form").html(t.html),$(".form_popup").setCenterPositionAbsoluteScreen()}})}),$(document).on("click","#save-warehouses-locations-forall",function(t){id_product=$("#product_id").val(),$.ajax({url:url_global,type:"POST",async:!1,cache:!1,dataType:"json",data:"id_product="+id_product+"&ajax=1&action=processAllWarehousesAndLocations&"+$("input[class=chk_locations]").serialize()+"&"+$("input[class=input_locations]").serialize(),success:function(t){t.error?showErrorMessage(data.error):(showSuccessMessage(update_success_msg),$(".stage_popup_form, .form_popup").fadeOut(500))}})}),$(document).on("click",".set_warehouses_stock",function(t){t.preventDefault(),initFormEditWarehousesQties(this,$(this).data("id"),$(this).data("id-pa")?$(this).data("id-pa"):0)}),$(document).on("blur",".edit_realstock",function(t){var e,o,i;t.preventDefault(),e=$(this).attr("data-id"),o=$(this).attr("data-id-pa"),i=$(this).val(),$(this).parent().parent(),$.ajax({url:url_global,type:"POST",async:!1,cache:!1,dataType:"json",data:{ajax:!0,action:"updateRealQty",qty:i,id_product:e,id_product_attribute:o},success:function(t){t.result?"same"!=t.result&&("function"==typeof showSuccessMessage&&showSuccessMessage(update_success_msg),$("#real_quantity_"+e+"_"+o).addClass("update_done"),$(".physical_qty_"+e+"_"+o).html(t.physical_quantity).addClass("value_done"),$(".reserved_qty_"+e+"_"+o).html(t.reserved_quantity).addClass("value_done")):showErrorMessage(t.error)}})}),$(document).on("click",".applyQuantityAdvancedStock",function(t){var e,o=this;t.preventDefault(),e=$(this).closest("tr").find(":input").serialize(),$.ajax({url:url_global,type:"POST",dataType:"json",data:e+"&ajax=1&action=saveFormEditWarehousesQties",success:function(t){var e,i;t.hasError?t.msgError&&showErrorMessage(t.msgError):(e=$(o).data("id-product"),i=$(o).data("id-product-attribute"),showSuccessMessage(void 0!==t.msgSuccess?t.msgSuccess:update_success_msg),void 0!==t.quantity&&($("#real_quantity_"+e+"_"+i).addClass("value_done").val(t.quantity),$(".physical_qty_"+e+"_"+i).html(t.physical_quantity).addClass("value_done"),$(".warehouses_qty_"+e+"_"+i).html(t.warehouses_quantity).addClass("value_done")),initFormEditWarehousesQties(o,e,i))}})}),$(document).on("click",".alignWarehouseToPhysicalQty",function(t){var e,o,i;t.preventDefault(),e=this,o=$(e).data("id-product"),i=$(e).data("id-product-attribute"),$.ajax({url:url_global,type:"POST",dataType:"json",data:{ajax:1,action:"alignWarehousesQties",id_product:o,id_product_attribute:i},success:function(t){t.hasError?t.msgError&&showErrorMessage(t.msgError):(showSuccessMessage(t.msgSuccess),initFormEditWarehousesQties(e,o,i))}})}),$(document).on("change",".warehouse-select",function(){var t,e;if(currentElement=$(this),t=parseInt(currentElement.attr("id").replace("warehouse_","")),""==(e=currentElement.val())&&"undefined"!=typeof help_class_name&&"AdminWkwarehousesOrders"==help_class_name)return showErrorMessage(txt_warehouse_required),!1;$.ajax({url:admin_warehouses_orders_url,dataType:"json",method:"POST",data:{ajax:1,action:"updateOrderWarehouse",id_warehouse:e,id_order_detail:t},success:function(t){t.hasError?(showErrorMessage(t.msgError),currentElement.find("option").prop("selected",function(){return this.defaultSelected})):showSuccessMessage(t.msgOk)}})}),$(".formConfigWarehouses").on("submit",function(t){$("#priority_increase .warehouseList option, #priority_decrease .warehouseList option").prop("selected",!0)}),$("#priority_increase .menuOrderUp, #priority_decrease .menuOrderUp").click(function(t){t.preventDefault(),move($(this).parent().parent(),!0)}),$("#priority_increase .menuOrderDown, #priority_decrease .menuOrderDown").click(function(t){t.preventDefault(),move($(this).parent().parent(),!1)}),$(".swap-container").length>0&&$(".swap-container").each(function(){void 0!==typeof $(".addSwap",this)&&void 0!==typeof $(".removeSwap",this)&&void 0!==typeof $(".selectedSwap",this)&&void 0!==typeof $(".availableSwap",this)&&(container=this,bindSwapButton("add","available","selected",container),bindSwapButton("remove","selected","available",container),$("button:submit").click(function(){bindSwapSave(container)}))}),$(document).on("click","#WKWAREHOUSE_LOCATION_ORDER_PAGE_on",function(){$("input[name=WKWAREHOUSE_CHANGE_ORDER_WAREHOUSE]").attr("disabled",!1)}),$(document).on("click","#WKWAREHOUSE_LOCATION_ORDER_PAGE_off",function(){$("input[id=WKWAREHOUSE_CHANGE_ORDER_WAREHOUSE_off]").attr("checked",!0),$("input[name=WKWAREHOUSE_CHANGE_ORDER_WAREHOUSE]").attr("disabled",!0)}),$(document).on("click","#WKWAREHOUSE_ALLOWSET_WAREHOUSE_on",function(){$("input[name=WKWAREHOUSE_DISPLAY_SELECTED_WAREHOUSE]").attr("disabled",!0),$("input[id=WKWAREHOUSE_DISPLAY_SELECTED_WAREHOUSE_off]").attr("checked",!0)}),$(document).on("click","#WKWAREHOUSE_ALLOWSET_WAREHOUSE_off",function(){$("input[name=WKWAREHOUSE_DISPLAY_SELECTED_WAREHOUSE]").attr("disabled",!1),$("input[id=WKWAREHOUSE_DISPLAY_SELECTED_WAREHOUSE_on]").attr("checked",!1)}),$(document).on("click","#WKWAREHOUSE_DISPLAY_SELECTED_WAREHOUSE_on",function(){$("input[name=WKWAREHOUSE_ALLOWSET_WAREHOUSE]").attr("disabled",!0),$("input[id=WKWAREHOUSE_ALLOWSET_WAREHOUSE_off]").attr("checked",!0)}),$(document).on("click","#WKWAREHOUSE_DISPLAY_SELECTED_WAREHOUSE_off",function(){$("input[name=WKWAREHOUSE_ALLOWSET_WAREHOUSE]").attr("disabled",!1),$("input[id=WKWAREHOUSE_ALLOWSET_WAREHOUSE_on]").attr("checked",!1)}),$(document).on("click","#WKWAREHOUSE_DISPLAY_WAREHOUSE_NAME_off",function(){$("input[id=WKWAREHOUSE_DISPLAY_SELECTED_LOCATION_on]").attr("checked",!0)}),$(document).on("click","#WKWAREHOUSE_DISPLAY_SELECTED_LOCATION_off",function(){$("input[id=WKWAREHOUSE_DISPLAY_WAREHOUSE_NAME_on]").attr("checked",!0)}),$(document).on("click","#WKWAREHOUSE_WAREHOUSES_INCART_off",function(){$("input[id=WKWAREHOUSE_LOCATIONS_INCART_on]").attr("checked",!0)}),$(document).on("click","#WKWAREHOUSE_LOCATIONS_INCART_off",function(){$("input[id=WKWAREHOUSE_WAREHOUSES_INCART_on]").attr("checked",!0)}),$(document).on("click","#WKWAREHOUSE_ALLOW_MULTIWH_CART_off",function(){$("input[name=WKWAREHOUSE_ALLOW_MULTICARRIER_CART]").attr("disabled",!0),$("input[id=WKWAREHOUSE_ALLOW_MULTICARRIER_CART_off]").attr("checked",!0)}),$(document).on("click","#WKWAREHOUSE_ALLOW_MULTIWH_CART_on",function(){$("input[name=WKWAREHOUSE_ALLOW_MULTICARRIER_CART]").attr("disabled",!1)}),$("#import_stop_button").unbind("click").click(function(){importContinueRequest?($("#importProgress").modal("hide"),importContinueRequest=!1,window.location.href=url_global):(importCancelRequest=!0,$("#import_details_progressing").hide(),$("#import_details_finished").hide(),$("#import_details_stop").show(),$("#import_stop_button").hide(),$("#update_close_button").hide())}),$("#import_continue_button").unbind("click").click(function(){$("#import_continue_button").hide(),importContinueRequest=!1,$("#import_progress_div").show(),$("#import_details_warning ul, #import_details_info ul").html(""),$("#import_details_warning, #import_details_info").hide(),processNow(0,5,-1,!1)}),$("#update_close_button, #importProgress .close").unbind("click").click(function(){window.location.href=url_global}),$(document).on("click","#submit-bulk-btn",function(t){t.preventDefault();var e=!1;if("sel"==$(".bulk_for").val()&&($("#"+s+" .productOutBox").each(function(){if(this.checked)return e=!0,!1}),!e))return showErrorMessage(msg_required),!1;processNow(0,5,-1,!0)}),"undefined"!=typeof orderLocations&&($("#orderProductsTable").length>0?$("#orderProductsTable thead tr").find("th:nth-child(3)").after('<th class="text-left"><p>'+txt_warehouse+"</p></th>"):$("#orderProducts thead tr").find("th:nth-child(5)").html('<span class="title_box"><strong>'+txt_warehouse+"</strong></span>"),r=$("#orderProductsTable").length>0?"orderProductsTable":"orderProducts",$("#"+r+" tbody "+("orderProducts"==r?"tr.product-line-row":"tr")).each(function(){var t,e,o="orderProducts"==r?$(this).find("td .edit_product_id_order_detail").val():parseInt($(this).attr("id").replace("orderProduct_",""));if(void 0!==o)if(void 0!==(t=orderLocations[o])){for(e='<ul style="padding-left:10px">',i=0;i<t.length;i++){if(canChangeWarehouse){if(t[i].warehouseList){for(k in e+='<li><select class="warehouse-select" id="'+o+'">',e+='<option value="">-- '+txt_no_warehouse+" --</option>",t[i].warehouseList)e+='<option value="'+t[i].warehouseList[k].id_warehouse+'" ',e+=t[i].warehouseList[k].is_default?"selected":"",e+=">"+t[i].warehouseList[k].name+"</option>";e+="</select></li>"}}else e+="<li>"+t[i].name+"</li>";""!=t[i].location&&"undefined"!=t[i].location&&(e+='<li style="list-style-type:none">'+txt_location+": "+t[i].location+"</li>")}e+="</ul>","orderProducts"==r?$(this).find("td:nth-child(5)").html(e):$(this).find("td:nth-child(3)").after('<td class="cellProductWarehouse text-left">'+e+"</td>")}else"orderProducts"==r?$(this).find("td:nth-child(5)").html(""):$(this).find("td:nth-child(3)").after("<td></td>")}))}),void 0===$.fn.setCenterPositionAbsoluteScreen&&($.fn.setCenterPositionAbsoluteScreen=function(){var t=20,e=$(document).scrollTop(),o=$(this).width(),i=$(window).width();$(this).css({top:$(this).height()>$(window).height()?e+t:e+($(window).height()-$(this).height())/2,left:(i-o)/2})}),function(t){t.fn.slideUpTransition=function(){return this.each(function(){var e=t(this);e.css("max-height","0"),e.addClass("height-transition-hidden")})},t.fn.slideDownTransition=function(){return this.each(function(){var e,o=t(this);o.removeClass("height-transition-hidden"),o.css("max-height","none"),e=o.outerHeight(),o.css("max-height","0"),setTimeout(function(){o.css({"max-height":e})},1)})}}(jQuery);