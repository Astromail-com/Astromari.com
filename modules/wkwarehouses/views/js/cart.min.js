/**
* NOTICE OF LICENSE
*
* This file is part of the 'Wk Warehouses Management For Prestashop 1.7' module feature.
* Developped by Khoufi Wissem (2018).
* You are not allowed to use it on several site
* You are not allowed to sell or redistribute this module
* This header must not be removed
*
*  @author    KHOUFI Wissem - K.W
*  @copyright Khoufi Wissem
*  @license   http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
*/
function applyCssOnDeliveryAddressBlock(){$("#delivery-address-cart").length>0&&($(".card").length>0?($("#delivery-address-cart").addClass("card"),$("#delivery-address-cart").css({"margin-top":"1rem"})):$("#delivery-address-cart").css({"margin-top":"1rem",padding:"0.3rem 1rem 1rem 1rem","box-shadow":"2px 2px 8px 0 rgba(0, 0, 0, .2)",background:"#FFF"}))}function refreshCurrentDeliveryAddress(){return $.ajax({url:process_cart_url,type:"POST",dataType:"json",data:{ajax:!0,action:"refreshDeliveryAddressBlock"},beforeSend:function(){$("#delivery-address-cart").css("opacity","0.4")},success:function(e){$("#delivery-address-cart").css("opacity","1"),e.delivery_address?($("#delivery-address-cart").show(),$("#delivery-address-cart .card-block span").html(e.delivery_address)):$("#delivery-address-cart").hide()}}),!1}function loadCarriersRestrictionsInCart(e){var r=".cart-overview";e=JSON.parse(e),$(r).length>0&&($.each($(r+" .cart-item"),function(e,r){$(r).find(".carrier-restriction-info").remove(),$(r).css("border-bottom","1px solid #f2f2f2")}),$.each($(r+" .cart-item"),function(r,t){var a,d,i,o;$(t).find(".remove-from-cart").length>0&&(d=(a=$(t).find(".remove-from-cart")).data("id-product"),i=a.data("id-product-attribute")),void 0!==d&&void 0!==i&&$(t).find(".product-line-grid-body").length>0&&void 0!==e[d+"_"+i]&&(o='<div class="alert alert-warning carrier-restriction-info" style="padding:5px; margin-bottom:0">',o+="undefined"!=typeof undelivered_product_txt?undelivered_product_txt:"This product can not be delivered!",o+="</div>",$("<br />"+o).appendTo($(t)))}))}function loadWarehousesDetails(e){var r=".cart-overview";e=JSON.parse(e),$(r).length>0&&($.each($(r+" .cart-item"),function(e,r){$(r).find(".warehouse-info").remove(),$(r).css("border-bottom","1px solid #f2f2f2")}),$.each($(r+" .cart-item"),function(r,t){var a,d,i,o,s,n;$(t).find(".remove-from-cart").length>0&&(d=(a=$(t).find(".remove-from-cart")).data("id-product"),i=a.data("id-product-attribute")),void 0!==d&&void 0!==i&&$(t).find(".product-line-grid-body").length>0&&(o=e[d+"_"+i],console.log(o),void 0!==o&&(s=new Array,display_warehouse_name&&o.name&&s.push("<strong>"+o.name+"</strong>"),display_warehouse_location&&o.location&&s.push((display_warehouse_name?"":"<strong>")+item_location_txt+(display_warehouse_name?"":"</strong>")+" "+o.location),display_country&&o.country&&s.push(o.country),display_warehouse_quantity&&s.push((o.quantity>0?parseInt(o.quantity):0)+" "+item_instock_txt),display_delivery_time&&o.delivery_time&&s.push(o.delivery_time),s.length>0&&(n="belowProductName"==position_cart?"":"<br />",n+='<div class="alert alert-info warehouse-info" style="padding:5px; margin-bottom:0">',n+=s.join("<br />"),n+="</div>",$(n).appendTo("belowProductName"==position_cart?$(t).find(".product-line-grid-body"):$(t)))))}))}$(document).ready(function(){prestashop.on("updatedCart",function(e){"undefined"!=typeof warehouses_cart_details&&loadWarehousesDetails(warehouses_cart_details),"undefined"!=typeof carriers_restrictions&&loadCarriersRestrictionsInCart(carriers_restrictions),deliver_address_incart&&refreshCurrentDeliveryAddress()}),applyCssOnDeliveryAddressBlock()});